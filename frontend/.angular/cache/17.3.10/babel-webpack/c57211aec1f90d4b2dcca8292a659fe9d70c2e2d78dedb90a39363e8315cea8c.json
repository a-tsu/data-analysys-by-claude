{"ast":null,"code":"/**\n * This file is responsible for parsing the content from the DOM and making\n * sure data is nested properly.\n *\n * @author Tim Scanlin\n */\n\nexport default function parseContent(options) {\n  const reduce = [].reduce;\n\n  /**\n   * Get the last item in an array and return a reference to it.\n   * @param {Array} array\n   * @return {Object}\n   */\n  function getLastItem(array) {\n    return array[array.length - 1];\n  }\n\n  /**\n   * Get heading level for a heading dom node.\n   * @param {HTMLElement} heading\n   * @return {Number}\n   */\n  function getHeadingLevel(heading) {\n    return +heading.nodeName.toUpperCase().replace(\"H\", \"\");\n  }\n\n  /**\n   * Determine whether the object is an HTML Element.\n   * Also works inside iframes. HTML Elements might be created by the parent document.\n   * @param {Object} maybeElement\n   * @return {Number}\n   */\n  function isHTMLElement(maybeElement) {\n    try {\n      return maybeElement instanceof window.HTMLElement || maybeElement instanceof window.parent.HTMLElement;\n    } catch (e) {\n      return maybeElement instanceof window.HTMLElement;\n    }\n  }\n\n  /**\n   * Get important properties from a heading element and store in a plain object.\n   * @param {HTMLElement} heading\n   * @return {Object}\n   */\n  function getHeadingObject(heading) {\n    // each node is processed twice by this method because nestHeadingsArray() and addNode() calls it\n    // first time heading is real DOM node element, second time it is obj\n    // that is causing problem so I am processing only original DOM node\n    if (!isHTMLElement(heading)) return heading;\n    if (options.ignoreHiddenElements && (!heading.offsetHeight || !heading.offsetParent)) {\n      return null;\n    }\n    const headingLabel = heading.getAttribute(\"data-heading-label\") || (options.headingLabelCallback ? String(options.headingLabelCallback(heading.innerText)) : (heading.innerText || heading.textContent).trim());\n    const obj = {\n      id: heading.id,\n      children: [],\n      nodeName: heading.nodeName,\n      headingLevel: getHeadingLevel(heading),\n      textContent: headingLabel\n    };\n    if (options.includeHtml) {\n      obj.childNodes = heading.childNodes;\n    }\n    if (options.headingObjectCallback) {\n      return options.headingObjectCallback(obj, heading);\n    }\n    return obj;\n  }\n\n  /**\n   * Add a node to the nested array.\n   * @param {Object} node\n   * @param {Array} nest\n   * @return {Array}\n   */\n  function addNode(node, nest) {\n    const obj = getHeadingObject(node);\n    const level = obj.headingLevel;\n    let array = nest;\n    let lastItem = getLastItem(array);\n    const lastItemLevel = lastItem ? lastItem.headingLevel : 0;\n    let counter = level - lastItemLevel;\n    while (counter > 0) {\n      lastItem = getLastItem(array);\n      // Handle case where there are multiple h5+ in a row.\n      if (lastItem && level === lastItem.headingLevel) {\n        break;\n      } else if (lastItem && lastItem.children !== undefined) {\n        array = lastItem.children;\n      }\n      counter--;\n    }\n    if (level >= options.collapseDepth) {\n      obj.isCollapsed = true;\n    }\n    array.push(obj);\n    return array;\n  }\n\n  /**\n   * Select headings in content area, exclude any selector in options.ignoreSelector\n   * @param {HTMLElement} contentElement\n   * @param {Array} headingSelector\n   * @return {Array}\n   */\n  function selectHeadings(contentElement, headingSelector) {\n    let selectors = headingSelector;\n    if (options.ignoreSelector) {\n      selectors = headingSelector.split(\",\").map(function mapSelectors(selector) {\n        return `${selector.trim()}:not(${options.ignoreSelector})`;\n      });\n    }\n    try {\n      return contentElement.querySelectorAll(selectors);\n    } catch (e) {\n      console.warn(`Headers not found with selector: ${selectors}`); // eslint-disable-line\n      return null;\n    }\n  }\n\n  /**\n   * Nest headings array into nested arrays with 'children' property.\n   * @param {Array} headingsArray\n   * @return {Object}\n   */\n  function nestHeadingsArray(headingsArray) {\n    return reduce.call(headingsArray, function reducer(prev, curr) {\n      const currentHeading = getHeadingObject(curr);\n      if (currentHeading) {\n        addNode(currentHeading, prev.nest);\n      }\n      return prev;\n    }, {\n      nest: []\n    });\n  }\n  return {\n    nestHeadingsArray,\n    selectHeadings\n  };\n}","map":{"version":3,"names":["parseContent","options","reduce","getLastItem","array","length","getHeadingLevel","heading","nodeName","toUpperCase","replace","isHTMLElement","maybeElement","window","HTMLElement","parent","e","getHeadingObject","ignoreHiddenElements","offsetHeight","offsetParent","headingLabel","getAttribute","headingLabelCallback","String","innerText","textContent","trim","obj","id","children","headingLevel","includeHtml","childNodes","headingObjectCallback","addNode","node","nest","level","lastItem","lastItemLevel","counter","undefined","collapseDepth","isCollapsed","push","selectHeadings","contentElement","headingSelector","selectors","ignoreSelector","split","map","mapSelectors","selector","querySelectorAll","console","warn","nestHeadingsArray","headingsArray","call","reducer","prev","curr","currentHeading"],"sources":["/home/a-tsu/data-analysys-by-claude/frontend/node_modules/tocbot/src/js/parse-content.js"],"sourcesContent":["/**\n * This file is responsible for parsing the content from the DOM and making\n * sure data is nested properly.\n *\n * @author Tim Scanlin\n */\n\nexport default function parseContent(options) {\n  const reduce = [].reduce\n\n  /**\n   * Get the last item in an array and return a reference to it.\n   * @param {Array} array\n   * @return {Object}\n   */\n  function getLastItem(array) {\n    return array[array.length - 1]\n  }\n\n  /**\n   * Get heading level for a heading dom node.\n   * @param {HTMLElement} heading\n   * @return {Number}\n   */\n  function getHeadingLevel(heading) {\n    return +heading.nodeName.toUpperCase().replace(\"H\", \"\")\n  }\n\n  /**\n   * Determine whether the object is an HTML Element.\n   * Also works inside iframes. HTML Elements might be created by the parent document.\n   * @param {Object} maybeElement\n   * @return {Number}\n   */\n  function isHTMLElement(maybeElement) {\n    try {\n      return (\n        maybeElement instanceof window.HTMLElement ||\n        maybeElement instanceof window.parent.HTMLElement\n      )\n    } catch (e) {\n      return maybeElement instanceof window.HTMLElement\n    }\n  }\n\n  /**\n   * Get important properties from a heading element and store in a plain object.\n   * @param {HTMLElement} heading\n   * @return {Object}\n   */\n  function getHeadingObject(heading) {\n    // each node is processed twice by this method because nestHeadingsArray() and addNode() calls it\n    // first time heading is real DOM node element, second time it is obj\n    // that is causing problem so I am processing only original DOM node\n    if (!isHTMLElement(heading)) return heading\n\n    if (\n      options.ignoreHiddenElements &&\n      (!heading.offsetHeight || !heading.offsetParent)\n    ) {\n      return null\n    }\n\n    const headingLabel =\n      heading.getAttribute(\"data-heading-label\") ||\n      (options.headingLabelCallback\n        ? String(options.headingLabelCallback(heading.innerText))\n        : (heading.innerText || heading.textContent).trim())\n    const obj = {\n      id: heading.id,\n      children: [],\n      nodeName: heading.nodeName,\n      headingLevel: getHeadingLevel(heading),\n      textContent: headingLabel,\n    }\n\n    if (options.includeHtml) {\n      obj.childNodes = heading.childNodes\n    }\n\n    if (options.headingObjectCallback) {\n      return options.headingObjectCallback(obj, heading)\n    }\n\n    return obj\n  }\n\n  /**\n   * Add a node to the nested array.\n   * @param {Object} node\n   * @param {Array} nest\n   * @return {Array}\n   */\n  function addNode(node, nest) {\n    const obj = getHeadingObject(node)\n    const level = obj.headingLevel\n    let array = nest\n    let lastItem = getLastItem(array)\n    const lastItemLevel = lastItem ? lastItem.headingLevel : 0\n    let counter = level - lastItemLevel\n\n    while (counter > 0) {\n      lastItem = getLastItem(array)\n      // Handle case where there are multiple h5+ in a row.\n      if (lastItem && level === lastItem.headingLevel) {\n        break\n      } else if (lastItem && lastItem.children !== undefined) {\n        array = lastItem.children\n      }\n      counter--\n    }\n\n    if (level >= options.collapseDepth) {\n      obj.isCollapsed = true\n    }\n\n    array.push(obj)\n    return array\n  }\n\n  /**\n   * Select headings in content area, exclude any selector in options.ignoreSelector\n   * @param {HTMLElement} contentElement\n   * @param {Array} headingSelector\n   * @return {Array}\n   */\n  function selectHeadings(contentElement, headingSelector) {\n    let selectors = headingSelector\n    if (options.ignoreSelector) {\n      selectors = headingSelector\n        .split(\",\")\n        .map(function mapSelectors(selector) {\n          return `${selector.trim()}:not(${options.ignoreSelector})`\n        })\n    }\n    try {\n      return contentElement.querySelectorAll(selectors)\n    } catch (e) {\n      console.warn(`Headers not found with selector: ${selectors}`) // eslint-disable-line\n      return null\n    }\n  }\n\n  /**\n   * Nest headings array into nested arrays with 'children' property.\n   * @param {Array} headingsArray\n   * @return {Object}\n   */\n  function nestHeadingsArray(headingsArray) {\n    return reduce.call(\n      headingsArray,\n      function reducer(prev, curr) {\n        const currentHeading = getHeadingObject(curr)\n        if (currentHeading) {\n          addNode(currentHeading, prev.nest)\n        }\n        return prev\n      },\n      {\n        nest: [],\n      },\n    )\n  }\n\n  return {\n    nestHeadingsArray,\n    selectHeadings,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}